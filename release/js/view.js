var $DT2017=$DT2017||{};$DT2017.view=function(){var e={init:function(e){console.log("--> init view ... params : ",e);this.appendBookContentsByListType({targetElement:e.targetElement,callBack:e.callBack,listType:$DT2017.core.currentListType,dataList:e.dataList}),$alt.addSwipeEvent({targetElement:e.targetElement,callBack:function(e){switch(console.log("--> direction: ",e),e){case"none":break;case"left":if($DT2017.bookEdit.isBookEditMode||$DT2017.core.isShowingBookDetailView)return void $DT2017.notice.show({noticeText:"현재 모드에서는 책장 이동을 할수 없습니다.",buttonText:"확 인",clickEvent:function(){console.log("> clickEvent!"),$DT2017.notice.hide()}});$alt.qs(".headerShelfListRightArrow ").click();break;case"right":if($DT2017.bookEdit.isBookEditMode||$DT2017.core.isShowingBookDetailView)return void $DT2017.notice.show({noticeText:"현재 모드에서는 책장 이동을 할수 없습니다.",buttonText:"확 인",clickEvent:function(){console.log("> clickEvent!"),$DT2017.notice.hide()}});$alt.qs(".headerShelfListLeftArrow ").click()}}})},appendBookContentsByListType:function(e){console.log("--> appendBookContentsByListType params : ",e),e.targetElement.innerHTML="";var t=this,o=$alt.ce({tag:"div","class":"booksContainer",targetElement:e.targetElement});if("store"===$DT2017.core.currentPageMode){var a=$alt.ce({tag:"div","class":"storeBgContainer",targetElement:e.targetElement}),l=$alt.ce({tag:"div","class":"storeBgBox",targetElement:a});l.style.backgroundImage="url(./images/view/storeBgIcon.png)",l.style.backgroundSize="216px",l.style.backgroundRepeat="no-repeat",l.style.width="216px",console.log("----*********------"),console.log($DT2017.responsive.screenSize.height+"px")}if(e.dataList.length>0)e.dataList.forEach(function(a,l){var n=$DT2017.core.emptyCheck(a.metadata.coverImage);switch(e.listType){case"image":var s=$alt.ce({tag:"div","class":"bookThumbnailBox",targetElement:o}),i=$alt.ce({tag:"img","class":"bookThumbnailImage",src:n?a.metadata.coverImage+"?temp="+$alt.generateUID():"./images/view/view_DefaultThumbnail.png",targetElement:s});i.setAttribute("bookData",JSON.stringify(a));var c=$alt.ce({tag:"div","class":"bookDetailButton",targetElement:s});if(c.setAttribute("bookData",JSON.stringify(a)),a._update){var r=$alt.ce({tag:"img","class":"updateIcon",src:"./images/view/view_update_icon.png",targetElement:s});r.style.cursor="pointer",r.addEventListener("click",function(e){e.preventDefault(),c.click()},!1),c.setAttribute("data-update",!0)}t.initBookDetailButton({targetElement:c,secondElement:i});var d=$alt.ce({tag:"div","class":"bookTitle",targetElement:s}),b=t.setIconStyle({type:a.type,text:a.metadata.courseName}),u=$alt.ce({tag:"div","class":"bookTitleIcon",html:b.label,targetElement:d});u.style.backgroundColor=b.colorCode;$alt.ce({tag:"div","class":"bookTitleText",html:" "+(a.metadata.lesson?a.metadata.lesson:a.metadata.title),targetElement:d});break;case"list":var k=$alt.ce({tag:"div","class":"bookThumbnailBoxForListType",targetElement:o}),d=$alt.ce({tag:"div","class":"bookTitleForListType",targetElement:k}),b=t.setIconStyle({type:a.type,text:a.metadata.courseName}),u=$alt.ce({tag:"div","class":"bookTitleIcon",html:b.label,targetElement:d});u.style.backgroundColor=b.colorCode;var g=($alt.ce({tag:"div","class":"bookTitleText",html:" "+a.metadata.title,targetElement:d}),$alt.ce({tag:"div","class":"bookDescription",html:a.metadata.description,targetElement:d}),$alt.ce({tag:"div","class":"bookThumbnailContainer",targetElement:k})),i=$alt.ce({tag:"img","class":"bookThumbnailImageForListType",src:n?a.metadata.coverImage+"?temp="+$alt.generateUID():"./images/view/view_DefaultThumbnail.png",targetElement:g});i.setAttribute("bookData",JSON.stringify(a));var c=$alt.ce({tag:"div","class":"bookDetailButtonForListType",targetElement:g});if(a._update){var r=$alt.ce({tag:"img","class":"updateIconForListType",src:"./images/view/view_update_icon.png",targetElement:g});r.style.cursor="pointer",r.addEventListener("click",function(e){e.preventDefault(),c.click()},!1),c.setAttribute("data-update",!0)}t.initBookDetailButton({targetElement:c,secondElement:i}),c.setAttribute("bookData",JSON.stringify(a))}switch(a.isExistFile&&"no"===a.isExistFile.toLowerCase().trim()&&(i.src="./images/view/noSDCardThumbnail.png"),a.type.toLowerCase().trim()){case"dtpcontents":case"zip":break;default:c.style.opacity=0}});else{var n=$alt.ce({tag:"div","class":"emptyBookShelfContainer",targetElement:o}),s=$alt.ce({tag:"div","class":"emptyBookShelfBox",targetElement:n}),i=($alt.ce({tag:"div","class":"emptyBookShelfText",html:"내 책장에 담은 책이 없습니다.",targetElement:s}),$alt.ce({tag:"div","class":"emptyBookShelfSubText",html:"원하는 디지털교과서를 내려 받아 보세요",targetElement:s}),$alt.ce({tag:"div","class":"emptyBookShelfButton",html:"디지털교과서 내려받기",targetElement:s}));i.addEventListener("click",function(e){e.preventDefault(),$DT2017.apiBridge.goStore()},!1),n.style.height=$DT2017.responsive.screenSize.height-120+"px","store"===$DT2017.core.currentPageMode&&$DT2017.store.emptyStore()}e.callBack&&e.callBack()},initBookDetailButton:function(e){var t=this,o=null;switch([e.targetElement,e.secondElement].forEach(function(e,a){1===a&&(o=JSON.parse(e.getAttribute("bookData"))),e.addEventListener("click",function(e){e.preventDefault(),console.log("--> click bookDetailButton!");var o=JSON.parse(this.getAttribute("bookData"));if("store"===$DT2017.core.currentPageMode)switch(o.type.toLowerCase().trim()){case"dtpcontents":case"zip":t.appendBookDetailView({targetElement:$DT2017.core.contentsArea,bookData:o});break;default:$DT2017.store.downloadMaterial(o)}else{var l=this.getAttribute("data-update");switch(o.type.toLowerCase().trim()){case"dtpcontents":0===a&&t.appendBookDetailView({targetElement:$DT2017.core.contentsArea,bookData:o,isUpdate:l}),1===a&&$DT2017.apiBridge.openViewer({bookId:o.bookId,path:o.extractPath});break;default:$DT2017.apiBridge.openViewer({bookId:o.bookId,path:o.extractPath})}}},!1);var l=$alt.qs(".searchContainer");l&&e.addEventListener("click",function(e){e.preventDefault(),document.body.removeChild(l)},!1)}),$DT2017.core.currentPageMode){case"bookShelf":case"store":var a=$alt.ce({tag:"img","class":"bookDetailIcon",src:"./images/bookDetailIcon.png",targetElement:e.targetElement});a.style.display="none",console.log("--> currentBookData: ",o);$alt.ce({tag:"div","class":"bookDetailInfo",html:o.metadata.gradeGroup+"<br>"+o.metadata.rightsHolder+"<br>"+o.metadata.creator,targetElement:e.targetElement}),$alt.ce({tag:"div","class":"bookDetailText",html:"상세<br>보기",targetElement:e.targetElement})}},setIconStyle:function(e){var t;if("store"===$DT2017.core.currentPageMode)t=$DT2017.store.setIconStyle(e);else{var o="",a="";switch(e.type.toLowerCase().trim()){case"epub":o="전자책",a="#218aad";break;case"dtpcontents":o="교과서",a="#976ab6";break;case"pdf":o="PDF",a="#e66059";break;case"hwp":o="HWP",a="#218aad";break;case"ppt":o="PPT",a="#976ab6";break;case"note":o="노트",a="#ff6600";break;default:o="ETC",a="#ccc"}t={label:o,colorCode:a}}return t},appendBookDetailView:function(e){console.log("--> appendBookDetailView ... params : ",e),$DT2017.core.isShowingBookDetailView=!0;var t=this,o=$alt.ce({tag:"div","class":"bookDetailViewContainer",targetElement:e.targetElement});o.style.opacity=0;var a=$alt.ce({tag:"div","class":"topMenubarTop",targetElement:o}),l=$alt.ce({tag:"div","class":"bookDetailViewHeaderText",html:"상세 보기",targetElement:a}),n=$alt.ce({tag:"img","class":"bookDetailCloseButton",src:"./images/bookDetailView/btn_home.png",targetElement:a});n.addEventListener("click",function(a){a.preventDefault(),t.closeBookDetailView({parentElement:e.targetElement,targetElement:o})},!1);var s=$alt.ce({tag:"div","class":"bookDetailViewInfoContainer",targetElement:o}),i=t.setIconStyle({type:e.bookData.type,text:e.bookData.metadata.courseName}),c=$alt.ce({tag:"div","class":"bookDetailViewBox",targetElement:s}),r=$alt.ce({tag:"div","class":"bookDetailViewHeader",targetElement:c}),d=$alt.ce({tag:"div","class":"bookDetailDescriptionIcon",html:i.label,targetElement:r});d.style.backgroundColor=i.colorCode;var b=($alt.ce({tag:"div","class":"bookDetailDescriptionTitle",html:e.bookData.metadata.title,targetElement:r}),$DT2017.core.emptyCheck(e.bookData.metadata.coverImage)),u=$alt.ce({tag:"img","class":"bookDetailViewThumbnail",src:b?e.bookData.metadata.coverImage:"./images/view/view_DefaultThumbnail.png",targetElement:c});e.bookData.isExistFile&&"no"===e.bookData.isExistFile.toLowerCase().trim()&&(u.src="./images/view/noSDCardThumbnail.png");var k=$alt.ce({tag:"div","class":"bookDetailDescriptionContainer",targetElement:c}),g=$alt.ce({tag:"div","class":"bookDetailDescriptionLeftTab",html:"책 정보",targetElement:k});g.addEventListener("click",function(e){e.preventDefault(),g.style.backgroundColor="#5b71d6",m.style.backgroundColor="#a5afc9",p.style.display="inline-block",D.style.display="none"},!1),g.style.backgroundColor="#5b71d6";var m=$alt.ce({tag:"div","class":"bookDetailDescriptionRightTab",html:"책 소개",targetElement:k});m.addEventListener("click",function(e){e.preventDefault(),g.style.backgroundColor="#a5afc9",m.style.backgroundColor="#5b71d6",D.style.display="block",p.style.display="none"},!1),m.style.backgroundColor="#a5afc9";var D=$alt.ce({tag:"div","class":"bookDetailDescriptionRightBox",html:e.bookData.metadata.description,targetElement:k}),p=$alt.ce({tag:"div","class":"bookDetailDescriptionBox",targetElement:k}),v=($alt.ce({tag:"div","class":"bookDetailDescriptionBoxDate",html:'<div class="bookDetailDescriptionBoxInlineStyle1"><div class="bulletIcon"></div>발행일</div><div class="bookDetailDescriptionBoxInlineStyle2">&nbsp;&nbsp;'+(e.bookData.metadata.date?e.bookData.metadata.date.slice(0,10):"-")+"</div>",targetElement:p}),$alt.ce({tag:"div","class":"bookDetailDescriptionBoxRightsHolder",html:'<div class="bookDetailDescriptionBoxInlineStyle1"><div class="bulletIcon"></div>저작권자</div><div class="bookDetailDescriptionBoxInlineStyle2">&nbsp;&nbsp;'+e.bookData.metadata.rightsHolder+"</div>",targetElement:p}),$alt.ce({tag:"div","class":"bookDetailDescriptionBoxPublisher",html:'<div class="bookDetailDescriptionBoxInlineStyle1"><div class="bulletIcon"></div>편찬자(저자)</div><div class="bookDetailDescriptionBoxInlineStyle2">&nbsp;&nbsp;'+e.bookData.metadata.creator+"</div>",targetElement:p}),$alt.ce({tag:"div","class":"bookDetailDescriptionBoxAuthor",html:'<div class="bookDetailDescriptionBoxInlineStyle1"><div class="bulletIcon"></div>발행인(개발사)</div><div class="bookDetailDescriptionBoxInlineStyle2">&nbsp;&nbsp;'+e.bookData.metadata.producer+"</div>",targetElement:p}),function(){$DT2017.responsive.enchantResponsive({responsivePointMobile:505,responsivePointTablet:770})});"store"===$DT2017.core.currentPageMode?(a.style.backgroundColor="#f9f7fa",a.style.boxShadow="0 1px 3px 0 #bcbcbc",l.style.color="#023c73",l.style.textShadow="none",l.innerHTML="스토어 상세 보기",n.src="./images/bookDetailView/btn_store_home.png",$DT2017.store.getSubBookList({bookId:e.bookData.bookId,contentsSeq:e.bookData.contentsSeq,type:e.bookData.type,callBack:function(a){t.initSubData({targetElement:o,epubItem:a.response.epubItem,bookData:e.bookData}),v()}})):(t.initSubData({targetElement:o,epubItem:e.bookData.epubItem,bookData:e.bookData,isUpdate:e.isUpdate}),v()),v(),$ANIDom.addAni({delay:1,duration:400,target:o,ease:{type:"quintInOut",apply:"all"},start:{x:0,y:0,rot:0,scale:1,opacity:0},destination:{x:0,y:0,rot:0,scale:0,opacity:1},callBack:function(){}})},closeBookDetailView:function(e){$DT2017.core.isShowingBookDetailView=!1,$ANIDom.addAni({delay:1,duration:400,target:e.targetElement,ease:{type:"quintInOut",apply:"all"},start:{x:0,y:0,rot:0,scale:1,opacity:1},destination:{x:0,y:0,rot:0,scale:0,opacity:-1},callBack:function(){e.parentElement.removeChild(e.targetElement)}})},initSubData:function(t){console.log("@==> initSubData params: ",t);var o,a,l=$alt.ce({tag:"div","class":"classDataContainer",targetElement:t.targetElement}),n=function(){var e=$alt.qsa(".contentTableHeadCheckBoxImg");$DT2017.core.selectedComboBoxList=[];for(var t=0;t<e.length;t++){var o=JSON.parse(e[t].getAttribute("data-subBook")),a=e[t].getAttribute("data-disable");"true"!==a&&(e[t].src="./images/subMenu/contentCheckbox_check.png",e[t].setAttribute("data-selected",!0)),o&&"true"!==a&&$DT2017.core.selectedComboBoxList.push(o)}console.log("- selectedComboBoxList: ",$DT2017.core.selectedComboBoxList)},s=function(){$DT2017.core.selectedComboBoxList=[];for(var e=$alt.qsa(".contentTableHeadCheckBoxImg"),t=0;t<e.length;t++)e[t].src="./images/subMenu/contentCheckbox_normal.png",e[t].setAttribute("data-selected",!1);console.log("- selectedComboBoxList: ",$DT2017.core.selectedComboBoxList)},i=function(e){var t=$alt.qs(".contentTableHeadCheckBoxImg"),o=t.getAttribute("data-selected");"false"===o?(n(),t.setAttribute("data-selected",!0)):(s(),t.setAttribute("data-selected",!1))};if("store"===$DT2017.core.currentPageMode){var c=$alt.ce({tag:"div","class":"comboBoxAllSelect",html:"전체 선택",targetElement:l});c.addEventListener("click",i,!1);var r=$alt.ce({tag:"div","class":"selectComboBoxDownload",html:"선택한 책 내려받기",targetElement:l});r.addEventListener("click",function(e){if(e.preventDefault(),$DT2017.core.selectedComboBoxList.length>0){console.log("%c ▶▷ [Native API] downloadSubBookList ","color:#ff6600");var o={apiName:"downloadSubBookList",parameters:{isUpdateDownload:"no",isStoreDownload:"yes",isMaterialsDownload:"dtContent"===$DT2017.core.currentStoreCategory?"no":"yes",fullBookId:t.bookData.bookId,contentsSeq:t.bookData.contentsSeq,downloadCommonUrl:t.bookData.downloadCommonUrl,commonVolume:t.epubItem[0].commonVolume,downloadSubBookList:$DT2017.core.selectedComboBoxList},callBack:"downloadSubBookListCallBack"};window[o.callBack]=function(e){var t=Object.keys(e),a=$alt.qs(".comboBoxAllSelect");switch(t[0]){case"response":s(),a.setAttribute("data-selected",!1);var l=$alt.qsa(".contentTableHeadCheckBoxImg");e.response.resultList.forEach(function(e,t){for(var o=0;o<l.length;o++){var a=JSON.parse(l[o].getAttribute("data-subBook"));if(a&&e.subBookId.trim()===a.subBookId.trim()){var n=l[o].parentNode.parentNode,s=n.querySelector(".classDataTableViewer");s.innerHTML="내려받기 완료",s.style.color="#ccc",n.querySelector(".widthDownload").style.color="#ccc",l[o].style.pointerEvents="none",l[o].style.opacity=.3,l[o].setAttribute("data-disable",!0)}}}),$DT2017.notice.show({type:"confirm",title:"내려받기 완료",noticeText:"<br><br>내려받기가 완료되었습니다.",buttonText:"내 서재 이동",clickEvent:function(){console.log("> clickEvent!"),$DT2017.apiBridge.goBookShelf(),$DT2017.notice.hide()},noButtonText:"닫기",noButtonEvent:function(){$DT2017.notice.hide()}});break;case"error":s(),a.setAttribute("data-selected",!1),$DT2017.notice.show({noticeText:e.error?e.error:"내려받기에 실패하였습니다!",buttonText:"확 인",clickEvent:function(){console.log("> clickEvent!"),$DT2017.notice.hide()}})}delete window[o.callBack]},$DT2017.apiBridge.sendMessageToNative(o.apiName,JSON.stringify(o));var a={response:{resultList:[{subBookId:"urn:uuid:361b7e67-d0e6-576a-a5f7-a4f51b8962f0",isDownload:"yes"},{subBookId:"urn:uuid:47606ed4-d8ed-57c1-bc44-423217c53360",isDownload:"yes"}]}};window[o.callBack](a)}else $DT2017.notice.show({noticeText:"내려받을 책을 선택하세요.",buttonText:"확 인",clickEvent:function(){console.log("> clickEvent!"),$DT2017.notice.hide()}})},!1),o="용량",a="내려받기"}else{o="내려받기",a="학습하기";var d=($alt.ce({tag:"div","class":"ghostButton",targetElement:l}),$alt.ce({tag:"div","class":"deleteSubBookButton",html:"삭제",targetElement:l}));if(d.addEventListener("click",function(o){if(o.preventDefault(),$DT2017.core.selectedComboBoxList.length>0){$DT2017.loading.show({opacity:.5,showLoadingIcon:!0});var a=$DT2017.core.getDeleteList($DT2017.core.selectedComboBoxList);$DT2017.apiBridge.deleteSubBook({bookId:t.bookData.bookId,deleteList:a,callBack:function(){$DT2017.loading.hide(),$DT2017.notice.show({noticeText:"선택한 디지털교과서가 삭제되었습니다.",buttonText:"확 인",clickEvent:function(){console.log("> clickEvent!"),$DT2017.notice.hide(),$DT2017.core.updateContentsForDelete({bookId:t.bookData.bookId,subBookIdList:a}),e.updateDeletedElement({subBookIdList:a})}})}})}else $DT2017.notice.show({noticeText:"삭제 할 디지털교과서를 선택하세요.",buttonText:"확 인",clickEvent:function(){console.log("> clickEvent!"),$DT2017.notice.hide()}})},!1),"true"===t.isUpdate){var b=$alt.ce({tag:"div","class":"allUpdateBtn",html:"전체 업데이트",targetElement:l});b.addEventListener("click",function(e){e.preventDefault(),console.log("--> allUpdateBtn..."),console.log("- params.epubItem: ",t.epubItem);var o=[];t.epubItem&&t.epubItem.length>0&&t.epubItem.forEach(function(e){e._update&&o.push({subBookId:e.subBookId,downloadUrl:e._updateData.downloadUrl,subVolume:e._updateData.subVolume})});var a=$DT2017.core.getAddUpdateInfo(t.bookData.bookId,t.epubItem);a.forEach(function(e){o.push({subBookId:e.subBookId,downloadUrl:e.downloadUrl,subVolume:e.subVolume})}),console.log("-> addUpdateInfo: ",a),console.log(o),console.log("%c ▶▷ [Native API] downloadSubBookList ","color:#ff6600");var l={apiName:"downloadSubBookList",parameters:{isUpdateDownload:"yes",isStoreDownload:"no",isMaterialsDownload:"no",fullBookId:t.bookData.bookId,contentsSeq:t.bookData.contentsSeq,downloadCommonUrl:t.bookData._updateData.downloadCommonUrl,commonVolume:t.bookData._updateData.commonVolume,downloadSubBookList:o},callBack:"downloadSubBookListCallBack"};window[l.callBack]=function(e){var o=Object.keys(e);switch(o[0]){case"response":var a=$alt.qsa(".widthDownload");e.response.resultList.forEach(function(e,t){for(var o=0;o<a.length;o++){var l=JSON.parse(a[o].getAttribute("data-subBook"));l&&e.subBookId.trim()===l.subBookId.trim()&&(a[o].innerHTML="내려받기 완료",a[o].style.color="#ccc",a[o].style.textDecoration="none",a[o].style.cursor="none",a[o].style.pointerEvents="none")}}),$DT2017.core.updateContentsList({bookId:t.bookData.bookId,subBookId:e.response.resultList[0].subBookId}),$DT2017.notice.show({noticeText:"전체 업데이트가 완료되었습니다.",buttonText:"확 인",clickEvent:function(){console.log("> clickEvent!"),$DT2017.notice.hide(),$DT2017.apiBridge.goBookShelf()}});break;case"error":$DT2017.notice.show({noticeText:e.error?e.error:"전체 업데이트에 실패하였습니다!",buttonText:"확 인",clickEvent:function(){console.log("> clickEvent!"),$DT2017.notice.hide()}})}delete window[l.callBack]},$DT2017.apiBridge.sendMessageToNative(l.apiName,JSON.stringify(l));var n={response:{resultList:[{subBookId:"urn:uuid:ecf98835-6fb8-689a-a328-46f409be1b83",isDownload:"yes"}]}};window[l.callBack](n)},!1)}}var u=$alt.ce({tag:"div","class":"classDataTable",targetElement:l}),k=$alt.ce({tag:"div","class":"classDataTableHead",targetElement:u}),g=$alt.ce({tag:"div","class":"classDataHeadStyle widthNumber",targetElement:k}),m=$alt.ce({tag:"img","class":"contentTableHeadCheckBoxImg",src:"./images/subMenu/contentCheckbox_normal.png",targetElement:g});m.setAttribute("data-selected",!1),m.addEventListener("click",i,!1);$alt.ce({tag:"div","class":"classDataHeadStyle widthTitle",html:"단원명",targetElement:k}),$alt.ce({tag:"div","class":"classDataHeadStyle widthDownload",html:o,targetElement:k}),$alt.ce({tag:"div","class":"classDataHeadStyle widthView",html:a,targetElement:k});t.epubItem.forEach(function(e,o){if("bookShelf"!==$DT2017.core.currentPageMode||0!==o){var a=$alt.ce({tag:"div","class":"classDataTableTr",targetElement:u}),l=$alt.ce({tag:"div","class":"classDataTableTrStyle widthNumber",targetElement:a}),n=$alt.ce({tag:"img","class":"contentTableHeadCheckBoxImg",src:"./images/subMenu/contentCheckbox_normal.png",targetElement:l});n.setAttribute("data-selected",!1),n.setAttribute("data-subBook",JSON.stringify({subBookId:e.subBookId,downloadUrl:e.downloadUrl,subVolume:e.subVolume})),n.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("data-selected"),o=JSON.parse(this.getAttribute("data-subBook"));if("false"===t)this.src="./images/subMenu/contentCheckbox_check.png",this.setAttribute("data-selected",!0),o&&$DT2017.core.selectedComboBoxList.push(o);else if(this.src="./images/subMenu/contentCheckbox_normal.png",this.setAttribute("data-selected",!1),o){var a=$DT2017.core.selectedComboBoxList.filter(function(e){return e.subBookId!==o.subBookId});$DT2017.core.selectedComboBoxList=a}console.log("- selectedComboBoxList: ",$DT2017.core.selectedComboBoxList)},!1);var s,i;$alt.ce({tag:"div","class":"classDataTableTrStyle widthBodyTitle",html:'<div class="classDataTableTitleText">'+(e._updateData&&e._updateData.lesson?e._updateData.lesson:e.lesson)+"</div>",targetElement:a});"store"===$DT2017.core.currentPageMode?(s=$DT2017.core.convertByte(e.subVolume),i={color:"yes"===e.isDownload.toLowerCase().trim()?"#ccc":"#777",textDecoration:"none",pointerEvents:"none"}):s="yes"===e.isDownload.toLowerCase().trim()?"내려받기 완료":"내려받기 가능";var c=$alt.ce({tag:"div","class":"classDataTableTrStyle widthDownload",html:s,targetElement:a});c.setAttribute("data-subBook",JSON.stringify({subBookId:e.subBookId,downloadUrl:e.downloadUrl,subVolume:e.subVolume})),e._update&&(c.setAttribute("data-updateData",JSON.stringify({downloadCommonUrl:e._updateData.downloadCommonUrl,downloadUrl:e._updateData.downloadUrl})),c.setAttribute("data-isUpdate",!0)),c.addEventListener("click",function(o){o.preventDefault();var a=this,l=JSON.parse(this.getAttribute("data-subBook")),s=JSON.parse(this.getAttribute("data-updateData")),i=this.getAttribute("data-isUpdate");if(console.log("@===> value: ",e),e._update&&"true"===i&&"yes"===e.isDownload.toLowerCase().trim()){console.log("%c ▶▷ [Native API] downloadSubBookList ","color:#ff6600");var c={apiName:"downloadSubBookList",parameters:{isUpdateDownload:"yes",isStoreDownload:"no",isMaterialsDownload:"no",fullBookId:t.bookData.bookId,contentsSeq:t.bookData.contentsSeq,downloadCommonUrl:t.bookData._updateData.downloadCommonUrl,commonVolume:e._updateData.commonVolume,downloadSubBookList:[{subBookId:l.subBookId,downloadUrl:s.downloadUrl,subVolume:l.subVolume}]},callBack:"downloadSubBookListCallBack"};window[c.callBack]=function(e){var o=Object.keys(e);switch(o[0]){case"response":a.innerHTML="내려받기 완료",a.style.color="#ccc",a.style.textDecoration="none",a.style.cursor="none",a.style.pointerEvents="none",$DT2017.core.updateContentsList({bookId:t.bookData.bookId,subBookId:e.response.resultList[0].subBookId}),$DT2017.notice.show({noticeText:"업데이트가 완료되었습니다.",buttonText:"확 인",clickEvent:function(){console.log("> clickEvent!"),$DT2017.notice.hide(),$DT2017.apiBridge.goBookShelf()}}),this.setAttribute("data-isUpdate",!1);break;case"error":$DT2017.notice.show({noticeText:e.error?e.error:"업데이트에 실패하였습니다!",buttonText:"확 인",clickEvent:function(){console.log("> clickEvent!"),$DT2017.notice.hide()}})}delete window[c.callBack]},$DT2017.apiBridge.sendMessageToNative(c.apiName,JSON.stringify(c));var r={response:{resultList:[{subBookId:"urn:uuid:ecf98835-6fb8-689a-a328-46f409be1b83",isDownload:"yes"}]}};window[c.callBack](r)}else{console.log("%c ▶▷ [Native API] downloadSubBookList ","color:#ff6600");var c={apiName:"downloadSubBookList",parameters:{isUpdateDownload:"no",isStoreDownload:"no",isMaterialsDownload:"no",fullBookId:t.bookData.bookId,contentsSeq:t.bookData.contentsSeq,downloadCommonUrl:t.bookData.downloadCommonUrl,commonVolume:"",downloadSubBookList:[{subBookId:l.subBookId,downloadUrl:l.downloadUrl,subVolume:l.subVolume}]},callBack:"downloadSubBookListCallBack"};window[c.callBack]=function(e){var o=Object.keys(e);switch(o[0]){case"response":a.innerHTML="내려받기 완료",a.style.color="#ccc",a.style.textDecoration="none",a.style.cursor="none",a.style.pointerEvents="none",$DT2017.core.updateContentsList({bookId:t.bookData.bookId,subBookId:e.response.resultList[0].subBookId}),$DT2017.notice.show({noticeText:"내려받기가 완료되었습니다.",buttonText:"확 인",clickEvent:function(){console.log("> clickEvent!"),d.style.color="#5b71d6",d.style.cursor="pointer",d.style.textDecoration="underline",d.style.pointerEvents="auto",n.style.pointerEvents="auto",n.style.opacity=1,n.setAttribute("data-disable",!1),$DT2017.core.refreshUpdateList({bookId:t.bookData.bookId,subBookId:e.response.resultList[0].subBookId}),$DT2017.notice.hide()}});break;case"error":$DT2017.notice.show({noticeText:e.error?e.error:"내려받기에 실패하였습니다!",buttonText:"확 인",clickEvent:function(){console.log("> clickEvent!"),$DT2017.notice.hide()}})}delete window[c.callBack]},$DT2017.apiBridge.sendMessageToNative(c.apiName,JSON.stringify(c));var r={response:{resultList:[{subBookId:"urn:uuid:ecf98835-6fb8-689a-a328-46f409be1b83",isDownload:"yes"}]}};setTimeout(function(){window[c.callBack](r)},500)}},!1),"no"===e.isDownload.toLowerCase().trim()?(c.style.color="#5b71d6",c.style.cursor="pointer",c.style.textDecoration="underline",i&&(c.style.color=i.color,c.style.textDecoration=i.textDecoration,c.style.pointerEvents=i.pointerEvents),"bookShelf"===$DT2017.core.currentPageMode&&(n.style.pointerEvents="none",n.style.opacity=.3,n.setAttribute("data-disable",!0))):(c.style.color="#ccc",c.style.pointerEvents="none","store"===$DT2017.core.currentPageMode&&(n.style.pointerEvents="none",n.style.opacity=.3,n.setAttribute("data-disable",!0))),e._update&&"yes"===e.isDownload.toLowerCase().trim()&&(c.innerHTML="업데이트",c.style.color="#f26422",c.style.textDecoration="underline",c.style.cursor="pointer",c.style.pointerEvents="auto");var r=$alt.ce({tag:"div","class":"classDataTableTrStyle widthViewer",targetElement:a});r.style.borderRight="0px";var d=$alt.ce({tag:"div","class":"classDataTableViewer",targetElement:r});"store"===$DT2017.core.currentPageMode?"yes"===e.isDownload.toLowerCase().trim()?d.setAttribute("data-text","내려받기 완료"):d.setAttribute("data-text","내려받기 가능"):(d.setAttribute("data-text","학습하기"),"no"===e.isDownload.toLowerCase().trim()&&(d.style.color="#ccc",d.style.textDecoration="none",d.style.pointerEvents="none")),i&&(d.style.color=i.color,d.style.textDecoration=i.textDecoration,d.style.pointerEvents=i.pointerEvents),d.setAttribute("bookData",JSON.stringify({bookId:t.bookData.bookId,extractPath:t.bookData.extractPath})),d.setAttribute("epubItemData",JSON.stringify(e)),d.addEventListener("click",function(e){e.preventDefault();var t=JSON.parse(this.getAttribute("bookData")),o=JSON.parse(this.getAttribute("epubItemData"));$DT2017.apiBridge.openViewer({bookId:t.bookId,path:t.extractPath,startPageNumber:o.startPageNumber})},!1)}})},reload:function(){console.log("-------------> reload!"),$DT2017.core.contentsArea.innerHTML="",this.appendBookContentsByListType({targetElement:$DT2017.core.contentsArea,callBack:function(){$DT2017.responsive.enchantResponsive({responsivePointMobile:505,responsivePointTablet:770})},listType:$DT2017.core.currentListType,dataList:$DT2017.core.selectedBookCase.currentBookList})},refresh:function(e){$DT2017.core.bookCaseList=[];var t="";e.response.response.UserData.BookShelf.shelfItem.forEach(function(e,o){$DT2017.core.bookCaseList.push(e),"yes"===e.isDefaultShelf.toLowerCase().trim()&&(t=e)}),$DT2017.core.contentsList=[],$DT2017.core.mergeContents({DtextData:e.response.response.DtextBook.BookList.bookItem,UserData:e.response.response.UserData.BookList.bookItem,callBack:function(){$DT2017.bookCase.selectBookCaseName(t),$DT2017.bookCase.currentBookCaseIndex=0,$DT2017.view.reload()}})},updateDeletedElement:function(e){console.log("--> updateDeletedElement params: ",e);var t=$alt.qsa(".contentTableHeadCheckBoxImg"),o=$alt.qsa(".widthDownload"),a=$alt.qsa(".classDataTableViewer");console.log(t),console.log(o),console.log(a);for(var l=0;l<t.length;l++){var n=JSON.parse(t[l].getAttribute("data-subBook"));if(n)for(var s=0;s<e.subBookIdList.length;s++)n.subBookId.trim()===e.subBookIdList[s].subBookId.trim()&&($DT2017.core.selectedComboBoxList=[],t[l].src="./images/subMenu/contentCheckbox_normal.png",t[l].setAttribute("data-selected",!1),t[l].style.pointerEvents="none",t[l].style.opacity=.3,t[l].setAttribute("data-disable",!0),o[l].style.color="#5b71d6",o[l].style.cursor="pointer",o[l].style.textDecoration="underline",o[l].style.pointerEvents="auto",o[l].innerHTML="내려받기 가능",o[l].setAttribute("data-isUpdate",!1),a[l-1].style.color="#ccc",a[l-1].style.textDecoration="none",a[l-1].style.pointerEvents="none")}},openBookDetailView:function(e){console.log("--> openBookDetailView: ",e);for(var t=$alt.qsa(".bookDetailButton"),o=0;o<t.length;o++){var a=JSON.parse(t[o].getAttribute("bookData"));if(a.bookId.trim()===e.bookId.trim())return void t[o].click()}}};return e}();