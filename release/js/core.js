"use strict";var $DT2017=$DT2017||{};$DT2017.core=function(){var t={version:"saltgamer.0.00.180118018",contentsArea:$alt.qs("#contentsArea"),isOfflineMode:!1,storeCode:[],showHelp:null,userInfo:null,noticeList:null,faqList:[],bookCaseList:[],contentsList:[],updateList:[],selectedBookCase:{bookCaseName:"",bookGroup:[],currentBookList:[]},currentPageMode:"bookShelf",currentSortType:!1,currentListType:"image",currentLeftMargin:0,currentStoreCategory:"dtContent",isShowingBookDetailView:!1,isShowingSlide:!1,selectedImportList:[],selectedComboBoxList:[],learningHelpMaterialList:[],learningMaterialList:[],mergeContents:function(t){var o=this;console.log(t),t.DtextData||t.UserData?(t.DtextData.forEach(function(t,e){$DT2017.core.contentsList.push(o.convertData(t))}),t.UserData.forEach(function(t,o){$DT2017.core.contentsList.push(t)}),console.log("--> $DT2017.core.contentsList : ",$DT2017.core.contentsList),t.callBack&&t.callBack()):$DT2017.notice.show({noticeText:"컨텐츠가 없습니다!",buttonText:"확 인",clickEvent:function(){console.log("> clickEvent!"),$DT2017.notice.hide()}})},convertData:function(t){return{downloadCommonUrl:t.downloadCommonUrl,type:t.type,extractPath:t.extractPath,bookId:t.fullBookId,contentsSeq:t.contentsSeq,epubItem:t.epubItem,isDownload:t.isDownload,isUpdate:t.isUpdate,downloadUrl:t.downloadUrl,metadata:t.metadata,isSaveSDCard:t.isSaveSDCard,isExistFile:t.isExistFile}},convertStoreData:function(t){return{downloadCommonUrl:t.downloadCommonUrl,downloadUrl:t.downloadUrl,bookId:t.fullBookId,fullVolume:t.fullVolume,contentsSeq:t.contentsSeq,type:"DTPCONTENTS",metadata:t.metadata}},convertMaterials:function(t){return{downloadCommonUrl:t.downloadCommonUrl,downloadUrl:t.downloadUrl,bookId:t.fullBookId,fullVolume:t.fullVolume,contentsSeq:t.contentsSeq,type:this.getMaterialType(t.downloadUrl),metadata:t.metadata}},getMaterialType:function(t){var o="epub";return t.toLowerCase().indexOf("epub")!==-1?o="epub":t.toLowerCase().indexOf("pdf")!==-1?o="pdf":t.toLowerCase().indexOf("zip")!==-1&&(o="zip"),o},emptyCheck:function(t){var o;return o=!(""===t||void 0===t||null===t)},convertByte:function(t){var t=parseInt(t),o=["bytes","KB","MB","GB","TB","PB"],e=Math.floor(Math.log(t)/Math.log(1024));return"-Infinity"==e?"0 "+o[0]:(t/Math.pow(1024,Math.floor(e))).toFixed(2)+" "+o[e]},convertDate:function(t){if(void 0===t||""===t)return"-";var o,e=t.split("-");return e.length>2?o=e[0]+"년 "+e[1]+"월 "+e[2].substring(0,2)+"일":e.length>1?o=e[0]+"년 "+e[1]+"월":e.length>0&&(o=e[0]+"년"),o},updateContentsList:function(t){console.log("--> updateContentsList!!! params: ",t);for(var o=$DT2017.core.contentsList,e=0;e<o.length;e++)if(o[e].bookId.trim()===t.bookId.trim()&&o[e].epubItem&&o[e].epubItem.length>0)for(var n=0;n<o[e].epubItem.length;n++)o[e].epubItem[n].subBookId.trim()===t.subBookId.trim()&&(o[e].epubItem[n].isDownload="yes",o[e].epubItem[n].isUpdate="no");this.updateAttributeData({bookId:t.bookId})},addUpdateDataToContentList:function(){var t=$DT2017.core.contentsList,o=$DT2017.core.updateList;t.forEach(function(t,e){for(var n=0;n<o.length;n++)if(t.bookId.trim()===o[n].fullBookId.trim()&&("yes"===o[n].isUpdate.toLowerCase().trim()&&(t._update=!0,t._updateData={downloadCommonUrl:o[n].downloadCommonUrl,downloadUrl:o[n].downloadUrl,commonVolume:o[n].commonVolume}),t.epubItem&&t.epubItem.length>0))for(var a=0;a<t.epubItem.length;a++)for(var r=0;r<o[n].epubItem.length;r++)"yes"===o[n].epubItem[r].isUpdate.toLowerCase().trim()?(t.epubItem[a].subBookId.trim()===o[n].epubItem[r].subBookId.trim()&&(t.epubItem[a]._update=!0,t.epubItem[a]._updateData={downloadCommonUrl:o[n].epubItem[r].downloadCommonUrl,downloadUrl:o[n].epubItem[r].downloadUrl,subVolume:o[n].epubItem[r].subVolume,lesson:o[n].epubItem[r].lesson}),t._update=!0,t._updateData={downloadCommonUrl:o[n].downloadCommonUrl,downloadUrl:o[n].downloadUrl,commonVolume:o[n].commonVolume}):t.epubItem[a].subBookId.trim()===o[n].epubItem[r].subBookId.trim()&&(t.epubItem[a]._updateData={lesson:o[n].epubItem[r].lesson})}),console.log("--> contentList: ",t)},getDeleteList:function(t){for(var o=[],e=0;e<t.length;e++)o.push({subBookId:t[e].subBookId});return o},updateContentsForDelete:function(t){for(var o=$DT2017.core.contentsList,e=0;e<o.length;e++)if(o[e].bookId.trim()===t.bookId.trim()&&o[e].epubItem&&o[e].epubItem.length>0)for(var n=0;n<o[e].epubItem.length;n++)for(var a=0;a<t.subBookIdList.length;a++)o[e].epubItem[n].subBookId.trim()===t.subBookIdList[a].subBookId.trim()&&(o[e].epubItem[n].isDownload="no");this.updateAttributeData({bookId:t.bookId})},updateAttributeData:function(t){console.log("--> updateAttributeData params: ",t);for(var o=$DT2017.core.contentsList,e=$alt.qsa(".bookDetailButton"),n=0;n<e.length;n++){var a=JSON.parse(e[n].getAttribute("bookData"));if(a.bookId.trim()===t.bookId.trim())for(var r=0;r<o.length;r++)o[r].bookId.trim()===t.bookId.trim()&&(console.log("--> new BookData: ",o[r]),e[n].setAttribute("bookData",JSON.stringify(o[r])))}},refreshUpdateList:function(t){console.log("--> refreshUpdateList!!! params: ",t);for(var o=$DT2017.core.contentsList,e=0;e<o.length;e++)if(o[e].bookId.trim()===t.bookId.trim()&&o[e].epubItem&&o[e].epubItem.length>0)for(var n=0;n<o[e].epubItem.length;n++)o[e].epubItem[n].subBookId.trim()===t.subBookId.trim()&&(o[e].epubItem[n]._update=null,o[e].epubItem[n]._updateData=null);this.updateAttributeData({bookId:t.bookId})},getAddUpdateInfo:function(t,o){var e=$DT2017.core.updateList,n=null;return e.forEach(function(e){if(e.fullBookId.trim()===t.trim()){for(var a=e.epubItem,r=0;r<o.length;r++){var l=a.filter(function(t){return t.subBookId.trim()!==o[r].subBookId});a=l}n=a}}),n},getBookIdList:function(t){var o=[];return t.forEach(function(t){o.push(t.bookId)}),o},updateMoveStorage:function(o){console.log("--> updateMoveStorage: ",o);for(var e=$DT2017.core.contentsList,n=0;n<e.length;n++)for(var a=0;a<o.length;a++)e[n].bookId.trim()===o[a].bookId.trim()&&(e[n].isSaveSDCard=o[a].isSaveSDCard,t.updateAttributeData({bookId:o[a].bookId}))}};return t}();